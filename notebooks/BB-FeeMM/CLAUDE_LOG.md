# BB-FeeMM 分析ログ

## 概要
BitbankのMaker Fee（-2bps）狙いの高頻度MM戦略の分析

## 2026-02-01: データ探索

### 実施内容
- `01_data_exploration.ipynb`: 各通貨ペアの基礎データ分析

### 主要な発見

#### 1. 約定量（1週間平均、JPY建て）
| 通貨ペア | 日次約定額 | 日次約定回数 |
|---------|-----------|------------|
| BTCJPY  | ¥2,528M   | 11,406     |
| XRPJPY  | ¥2,337M   | 20,829     |
| ETHJPY  | ¥1,573M   | 8,326      |
| DOGEJPY | ¥408M     | 4,268      |
| SOLJPY  | ¥337M     | 3,805      |
| LTCJPY  | ¥56M      | 1,191      |

#### 2. スプレッド分析
| 通貨ペア | 平均スプレッド(bps) | 中央値(bps) |
|---------|-------------------|------------|
| XRPJPY  | 0.92              | 0.52       |
| BTCJPY  | 0.99              | 0.39       |
| ETHJPY  | 1.20              | 0.79       |
| DOGEJPY | 2.52              | 2.13       |
| SOLJPY  | 2.79              | 2.14       |
| LTCJPY  | 14.50             | 12.84      |

**注意点**: Maker Fee (2bps) より狭いスプレッドが多い。スプレッドの直接収益は難しいが、Fee収益は可能。

#### 3. 板の厚み
- BTCJPYのBest Bid平均サイズ: 0.33 BTC
- XRPJPYのBest Bid平均サイズ: 21,751 XRP
- 十分な流動性が存在

#### 4. 総合評価
1. **XRPJPY**: 約定回数最多、スプレッド最小、約定額も高い → **最推奨**
2. **BTCJPY**: 約定額最大、スプレッド狭い → **推奨**
3. ETHJPY: バランス良い

### 次のステップ
1. XRPJPYとBTCJPYでより詳細な板情報分析
2. 極短期価格予測モデルの検討（板の動きによる予測）
3. MM戦略のシミュレーション設計

---

## 2026-02-01: 板情報シグナル分析

### 実施内容
- `02_orderbook_signal_analysis.ipynb`: Order Imbalanceと価格変動の関係分析

### 主要な発見

#### 1. Order Imbalanceと将来リターンの相関（XRPJPY）
| ホライズン | Imbalance相関 | L1 Imbalance相関 |
|-----------|--------------|-----------------|
| 100ms     | 0.0060       | 0.0072          |
| 500ms     | 0.0705       | 0.0840          |
| 1s        | 0.0948       | 0.1131          |
| 5s        | 0.1566       | 0.1877          |
| 10s       | 0.1763       | **0.2114**      |

**重要**: L1 Imbalanceと10秒後リターンに0.21の相関がある。これは極短期予測に使える。

#### 2. Imbalance分位数別リターン
| 分位数 | 1秒後リターン(bps) | 10秒後リターン(bps) |
|-------|------------------|-------------------|
| Q1(Sell偏り) | -0.064 | -0.655 |
| Q5(Buy偏り)  | +0.060 | +0.539 |
| **差分**     | **0.124** | **1.194** |

→ Q5 vs Q1 で10秒後に約1.2bpsの差がある

#### 3. シンプルなシグナル戦略のパフォーマンス（1日分）
| 閾値 | 取引回数 | 総リターン(bps) | 取引あたり(bps) | Sharpe |
|-----|---------|----------------|----------------|--------|
| 0.0 | 86,229  | 3,033          | 0.035          | 21.3   |
| 0.3 | 74,590  | 3,025          | 0.041          | 22.9   |
| 0.5 | 66,202  | 2,934          | 0.044          | 23.7   |

**注意**: これはフィクション的なリターン（スプレッド・手数料考慮前）

#### 4. 考察
- **Order Imbalanceは価格変動の先行指標として有効**
- L1（Best Bid/Ask）のImbalanceが特に予測力が高い
- 閾値を上げると取引頻度は下がるが、取引あたりの期待リターンは上がる
- **課題**: 実際のMM戦略では、Makerとして約定させる必要がある

### 次のステップ
1. 複数日でのロバスト性検証
2. MM戦略の具体設計（発注価格・サイズの決定ロジック）
3. Makerとして約定する確率のモデリング
4. バックテストフレームワークでの検証

---

## 2026-02-01: MM戦略バックテスト（v1）

### 実施内容
- `03_mm_backtest.ipynb`: Order ImbalanceベースのMM戦略バックテスト

### 戦略設計
1. **エントリー**: Imbalance > 閾値 → 買い / Imbalance < -閾値 → 売り
2. **発注価格**: Best Bid/Askに指値（Maker狙い）
3. **決済**: ポジション保持30秒でタイムアウト強制決済

### 結果（XRPJPY, 2026-01-25, 1日分）
| 指標 | 値 |
|-----|-----|
| 総約定数 | 46 |
| Maker約定 | 23 (50%) |
| Taker約定 | 23 (50%) |
| 総約定額 | ¥1,373,178 |
| **総合損益** | **¥-694** |

### 問題点の分析
1. **Maker比率が50%しかない**: ポジションタイムアウトでTaker決済が発生
2. **Taker Fee (12bps) が大きすぎる**: Maker Fee収益 (2bps) の6倍
3. **収支構造**:
   - 価格損益: ¥-7
   - Fee損益: ¥-687（Taker Feeで損失）

### パラメータ感度分析
| threshold | timeout | trade_count | maker_ratio | fee_pnl |
|-----------|---------|-------------|-------------|---------|
| 0.1       | 10      | 24          | 50%         | -358    |
| 0.3       | 30      | 46          | 50%         | -687    |
| 0.5       | 60      | 36          | 53%         | -496    |

→ どのパラメータでもマイナス。Taker決済が問題。

### 課題と改善案
1. **決済もMakerで行う**: タイムアウト時に成り行きではなく反対指値を出す
2. **約定確率の向上**: Best価格より有利な価格で発注（スプレッド内に入る）
3. **片側ポジションの回避**: 両建てで常にMaker約定を狙う
4. **他取引所の情報活用**: binance/bitmex等の価格変動を先行指標に使う

### 次のステップ
1. 決済ロジックの改善（Maker決済）
2. 両建てMM戦略の検討
3. 複数取引所の価格を使った予測シグナルの追加
